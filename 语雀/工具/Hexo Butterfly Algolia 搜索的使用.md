---
title: Hexo Butterfly Algolia æœç´¢çš„ä½¿ç”¨
urlname: '24'
date: 2021-05-11T11:00:00.000Z
updated: 2023-02-16T19:11:40.000Z
author: CCåº·çº³ç™¾å·
cover: 'https://cdn.nlark.com/yuque/0/2021/png/8391407/1620704686808-3b3ea7dc-2529-4e1e-a930-9e338dc07963.png'
description: æœ¬æ–‡ä»‹ç»äº† Hexo Butterfly ä¸»é¢˜ä¸‹ Algolia æœç´¢çš„ä½¿ç”¨
translate_title: hexo-butterfly-algolia
subtitle: Hexo Butterfly Algolia
'<font style="color:#404040;">tags': </font>å·¥å…·
'<font style="color:#404040;">keywords': '</font>[Hexo,Butterfly,Algolia]'
'<font style="color:#404040;">categories': å·¥å…·</font>
'<font style="color:#404040;">description': </font>æœ¬æ–‡ä»‹ç»äº† Hexo Butterfly ä¸»é¢˜ä¸‹ Algolia æœç´¢çš„ä½¿ç”¨
'<font style="color:#404040;">cover': '</font>https://pic1.afdiancdn.com/user/8a7f563c2e3811ecab5852540025c377/common/c9dcd19b9621a425f914ffb64cf2f8c1_w1920_h1080_s281.jpg'
'<font style="color:#404040;">id': 24</font>
---
æœ¬æ–‡ä»‹ç»äº† Hexo Butterfly ä¸»é¢˜ä¸‹ Algolia æœç´¢çš„ä½¿ç”¨



æœ¬æ–‡é¦–å‘åœ¨[**è¯­é›€**](https://www.yuque.com/ccknbc/blog/24/)

è‡ªåŠ¨åŒæ­¥æ›´æ–°è‡³[**CCçš„éƒ¨è½æ ¼**](https://blog.ccknbc.cc/posts/hexo-butterfly-algolia/)



## æ³¨å†Œè´¦å·
å‰å¾€ [Algolia](https://www.algolia.com/users/sign_up) å®˜ç½‘æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæ–°å»º åº”ç”¨å’Œ index

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620791672826-3bac29b1-3f60-4be8-bdc5-7b615e72f78a.png)

æ•°æ®ä¸­å¿ƒå»ºè®®é€‰æ‹©æ–°åŠ å¡æˆ–é¦™æ¸¯ï¼Œå½“ç„¶æ ¹æ®ä½ è‡ªå·±æƒ…å†µè€Œå®š

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620791714386-d2a2ac19-edfd-4c8b-ab02-9de7b770ff21.png)

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620791516501-3f36941d-cf13-49aa-bdb4-e956f632283a.png)

## å®‰è£…æ’ä»¶
```bash
npm install hexo-algolia --save
npm install hexo-algoliasearch --save
```

åˆ†åˆ«æ˜¯ [hexo-algolia](https://github.com/oncletom/hexo-algolia) å’Œ [hexo-algoliasearch](https://github.com/LouisBarranqueiro/hexo-algoliasearch)ï¼Œä»–ä»¬çš„ä»‹ç»åˆ†åˆ«ä¸º 

> Index your hexo website content to Algolia Search.  
>
> ğŸ” A plugin to index posts of your Hexo blog on Algolia
>

ä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ï¼Œå¦‚æœä½ æƒ³è¦å…¨ç«™æœç´¢å¯é€‰æ‹©å‰è€…ï¼Œå¦‚æœä½ åªæƒ³æœç´¢æ–‡ç« ä¸¤è€…å…¼å¯ã€‚ä½†å‰è€…ä¸èƒ½å°†æ–‡ç« å†…å®¹ä½œä¸ºç´¢å¼•ä¸Šä¼ ï¼ˆå…¶å®è€ç‰ˆæœ¬æ˜¯æ”¯æŒçš„ï¼Œä½†å› ä¸ºç´¢å¼•å¤§å°é™åˆ¶ï¼Œåœ¨æ–°ç‰ˆæœ¬å–æ¶ˆç´¢å¼•äº†æ–‡ç« å†…å®¹ï¼‰ï¼Œåè€…ç›®å‰ä»å¯å…¨æ–‡ä¸Šä¼ ã€‚

ç„¶åå°±æ˜¯ HEXOé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¸‹æ–‡åŸºæœ¬ä»¥ `hexo-algoliasearch` ä¸ºä¾‹ï¼Œå› ä¸ºæˆ‘ä¸ªäººè®¤ä¸ºè®¿å®¢åªä¼šæœæ–‡ç« å§ï¼ˆäº‹å®ä¸Šæ˜¯æœç´¢æ ¹æœ¬æ²¡äººç”¨ï¼Œæ¯•ç«Ÿä¹Ÿæ ¹æœ¬æ²¡äººè®¿é—®ï¼‰ï¼Œhexo-algolia å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæ³¨æ„é…ç½®å’Œå‘½ä»¤çš„åŒºåˆ«

>  _config.yml :
>

```yaml
algolia:
  appId: "Z7A3XW4R2I"
  apiKey: "12db1ad54372045549ef465881c17e743"
  adminApiKey: "40321c7c207e7f73b63a19aa24c4761b"
  chunkSize: 5000
  indexName: "my-hexo-blog"
  fields:
    - content:strip:truncate,0,500
    - excerpt:strip
    - gallery
    - permalink
    - photos
    - slug
    - tags
    - title
```

ä¸ºäº†ä¿é™©ï¼Œè¯†åˆ«åˆ°æ’ä»¶ï¼Œè¿˜å¯ä»¥åŠ å…¥ä»¥ä¸‹å†…å®¹

```yaml
plugins:
  - hexo-algoliasearch
```

å»ä¸»é¢˜é…ç½®æ–‡ä»¶æ‰“å¼€ Algolia æœç´¢ï¼Œè®°å¾—å…³é—­æœ¬åœ°æœç´¢ï¼ŒäºŒè€…åªèƒ½å–å…¶ä¸€ï¼

>  _config.butterfly.yml :
>

```yaml
# Algolia search
algolia_search:
  enable: true
  hits:
    per_page: 3
    
# Local search
local_search:
  enable: false
```

ç„¶åæ¥çœ‹ä»¥ä¸‹å…·ä½“çš„å‚æ•°é…ç½®è·å–æ–¹å¼

`appId`ï¼Œ`apiKey`ï¼Œ`adminApiKey`å¯åœ¨ API Keys é¡µé¢è·å–ï¼Œæ³¨æ„ä¿ç®¡å¥½ä½ çš„ Admin Keyï¼Œä¸è¦è®©å…¶ä»–äººçŸ¥é“ï¼Œä¸å»ºè®®ç›´æ¥å†™åœ¨é…ç½®ä¸­

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620789827112-9247b7ae-f3c9-4807-93cd-46c2b8dbb2bc.png)

![](https://cdn.jsdelivr.net/gh/oncletom/hexo-algolia@main/algolia-write-key.png)

å¯¹äº Windows ç³»ç»Ÿï¼Œå¦‚æœä½ ä¸æƒ³æ¯æ¬¡éƒ½è¿›è¡Œè®¾å®šå˜é‡æ“ä½œï¼Œå¯ä»¥æ·»åŠ `ALGOLIA_ADMIN_API_KEY`åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620789745876-cbf0d411-f694-45c7-bcbd-c0987f71f718.png)

è€Œ hexo-algolia æ’ä»¶ç¯å¢ƒå˜é‡åç§°ä¸º `HEXO_ALGOLIA_INDEXING_KEY` æ³¨æ„æ ¹æ®å¯¹åº”çš„æ–‡æ¡£æ›´æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# Windows
## å¾®è½¯çš„ powershell)
$env:ALGOLIA_ADMIN_API_KEY = ""

## cmd
å»ºè®®ä¸ç”¨ cmdï¼Œæ­£ç»äººä¸ç”¨ cmd

# Linux
## sh/bash
export ALGOLIA_ADMIN_API_KEY=

## fish
set -xg ALGOLIA_ADMIN_API_KEY ""
```



å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ä½¿ç”¨çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œä¾‹å¦‚ Github Actionsï¼Œä½ å¯ä»¥åœ¨å·¥ä½œæµä¸­ä¸€å¼€å§‹æˆ–è€…å¯¹åº”çš„æ­¥éª¤æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œè®°å¾— Secrets ä¸­ä¹Ÿè¦æ·»åŠ å“¦

```yaml
jobs:
  deploy:
    name: Deploy Hexo Public To Pages
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai
      ALGOLIA_ADMIN_API_KEY: ${{ secrets.ALGOLIA_ADMIN_API_KEY }}
```

æˆ–è€…ä½¿ç”¨

```bash
export ALGOLIA_ADMIN_API_KEY=â€¦
export HEXO_ALGOLIA_INDEXING_KEY=â€¦
```

`indexName` å³ä½ å¼€å§‹æ–°å»ºçš„ç´¢å¼•åç§°

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620790208902-1a6311bf-bd58-4889-9261-f2b6dd4d779e.png)

å…¶ä»–å†…å®¹ä¿æŒé»˜è®¤å³å¯ï¼Œä½†å¯¹äº`fields`

### é…ç½®ç¤ºä¾‹
è¿™é‡Œé€‰æ‹©ä¸æˆªå–ä¸Šä¼ å…¨æ–‡ï¼Œå¹¶ä¸”åˆ é™¤ html æ ‡ç­¾ï¼Œåªç•™ä¸‹æœ‰ç”¨çš„æœç´¢å†…å®¹

```yaml
fields:
  - content:strip
  - excerpt:strip
  - gallery
  - permalink
  - photos
  - slug
  - tags
  - title
```

ä½†å¯¹äºåšå®¢æ¥è¯´ï¼Œæ²¡äººä¼šæŒ‰ç…§ tags photosï¼ˆæˆ–è€…coverï¼‰æ¥æœç´¢å§ï¼Œæ‰€ä»¥æœ‰äº›å†…å®¹ä¸å¿…è¦ä¸Šä¼ ï¼Œå¹¶å¦‚æœä½ å’Œæˆ‘ä¸€æ ·æœ‰å¤šä¸ªé•œåƒç«™ï¼Œåœ¨ä¸æ”¹æºç ï¼ˆalgolia.jsï¼‰çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨ permalink è€Œä½¿ç”¨ pathï¼ˆæ”¹æºç å¯ä»¥ä½¿ç”¨ slugï¼Œä½†æ²¡å¿…è¦ï¼‰ï¼Œå¹¶ä¸”åªç•™ä¸‹å¿…è¦çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```yaml
algolia:
  appId: "947RX7HP3E"
  apiKey: "9114b3fa2a3307b2cc8eec7e3ae5a8ea"
  chunkSize: 5000
  indexName: "ccknbc-blog"
  fields:
    - path
    - title
    - content:strip
```

è¿™æ ·æœ‰äº†æ ‡é¢˜ï¼Œå…¨æ–‡å†…å®¹ï¼Œè·¯å¾„å³å¯åœ¨ä¸åŒé•œåƒç«™æ‰¾åˆ°å¯¹åº”çš„é¡µé¢ï¼Œè€Œä¸æ˜¯è·³åˆ°ä¸»ç«™ï¼Œå½“ç„¶ä½ é€‰æ‹©è·³åˆ°ä¸»ç«™æ— å¯åšéã€‚

## ä½¿ç”¨å‘½ä»¤
```bash
hexo algolia
è€Œåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦hexo gç”Ÿæˆæ–‡ä»¶
æ‰€ä»¥å…·ä½“ä½¿ç”¨å‘½ä»¤å°±æ˜¯
hexo cl && hexo g && hexo algolia
æˆ–è€…åœ¨æœªå®‰è£… HEXO CLI çš„æƒ…å†µä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤
npm run clean && npm run build && hexo algolia -n && gulp
```

### å¯é€‰é…ç½®
æ˜¯å¦åˆ é™¤ä¹‹å‰å»ºç«‹å¥½çš„ç´¢å¼•é‡æ–°å»ºç«‹ç´¢å¼•ï¼Ÿ

```bash
hexo algolia -n
æˆ–è€…
hexo algolia --no-clear
```

æ³¨æ„æŸ¥çœ‹å‘½ä»¤è¡Œè¾“å‡ºä¿¡æ¯ï¼Œç„¶åå»å®˜ç½‘æ£€æŸ¥ç´¢å¼•æ˜¯å¦ç”Ÿæˆ

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792250950-8c6c2e31-a5f4-41d3-8526-c101b88ca2f0.png)

äº‹å®ä¸Šåˆ°è¿™é‡Œå·²ç»å¯ä»¥è·å¾—ä¸‹å›¾æ‰€ç¤ºçš„æœç´¢æ•ˆæœï¼ˆè¿™æ˜¯å†°è€å¸ˆåšå®¢çš„æ•ˆæœï¼Œå®ƒä½¿ç”¨çš„æ˜¯ hexo-algoliaï¼Œæ¯•ç«Ÿæœ‰å…³äºæˆ‘ç•Œé¢ï¼‰

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1623297781030-708a3fa6-a56d-4fe0-bb45-5c3bb9081eba.png)

## Algoliaé…ç½®
è¿™é‡Œä¸ç»†èŠ‚è®²ï¼Œä½ å¯ä»¥æŸ¥é˜…[å®˜æ–¹æ–‡æ¡£](https://community.algolia.com/instantsearch.js/v2/getting-started.html)ï¼Œè™½ç„¶æœ‰äº›è¿‡æ—¶çš„å‚æ•°ï¼Œä½†ç»“åˆ [Upgrade from v2 to v3](https://www.algolia.com/doc/guides/building-search-ui/upgrade-guides/js/#upgrade-from-v2-to-v3) è¿˜æ˜¯å‹‰å¼ºèƒ½ç”¨ï¼Œè´è¶å·²ç»åšå¥½äº†é«˜äº®æ ‡é¢˜ï¼Œè™½ç„¶ä¼šæŸ¥è¯¢æ–‡ç« å†…å®¹ï¼Œä½†å¹¶ä¸ä¼šé«˜äº®æ–‡ç« å†…å®¹èŠ‚é€‰ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿®æ”¹éƒ¨åˆ† js å†…å®¹ï¼Œå¹¶å¯¹åº”çš„è®¾ç½®å¥½ Algoliaï¼Œä»¥ä¾¿æŒ‰ç…§æˆ‘ä»¬è¦æ±‚çš„ä¼˜å…ˆé¡ºåºå±•ç¤ºæœç´¢ç»“æœï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å¾ˆå¥‡æ€ªçš„æ’åºï¼Œæ¯•ç«Ÿé’ˆå¯¹ä¸­æ–‡åˆ†è¯ä»–æ˜¯ä¸€ä¸ªä¸€ä¸ªåˆ†ä¸èƒ½æŒ‰ç…§è‹±è¯­é‚£æ ·ï¼Œé’ˆå¯¹è‹±æ–‡æˆ‘ä»¬å¯ä»¥å¼€å¯åˆ†è¯æŸ¥è¯¢ï¼Œé©¼å³°æŸ¥æ‰¾è€Œä¸æ˜¯ç›²ç›®çš„åŒ¹é…æ•´ä¸ªå•è¯ï¼Œå¹¶ä¸”å…è®¸æ‹¼é”™å­—æ¯æˆ–æ±‰å­—çš„æƒ…å†µå­˜åœ¨ï¼Œè¿™äº›éƒ½æ˜¯ä¸€ä¸ªæœç´¢ç³»ç»Ÿè¦è€ƒè™‘çš„é—®é¢˜ã€‚ç„¶åé’ˆå¯¹æœç´¢é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ–‡ç« å†…å®¹è¿›è¡Œåˆ‡ç‰‡æˆ–è€…<font style="color:#23263B;">å±æ€§çš„åˆ»ç”»ï¼Œä½† V2 æ‰€æ”¯æŒçš„åŠŸèƒ½å®åœ¨å¤ªå°‘ï¼Œæ´¾çš„ä¸Šç”¨åœºçš„å¤§æ¦‚å°±æ˜¯ åŒ¹é…çš„å­—è¯å†…å®¹ï¼ŒåŒ¹é…åº¦ï¼ŒåŒ¹é…å†…å®¹çš„æ‘˜å½•ï¼ˆé»˜è®¤10ä¸ªå­—è¯ï¼‰ï¼Œè¿˜æœ‰é«˜çº§æœç´¢ç”¨æ³•çš„å¯ç”¨ã€‚</font>

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792329244-9538543c-aafa-4a2a-a13b-a856839d99b4.png)



![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792359705-aca4db80-07ec-41b5-ba89-3e398e4832c3.png)

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792403427-919eeaf3-beee-43b8-ba15-33d179fb7483.png)

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792429374-c10f685c-42df-4b2f-8112-b63b811686f5.png)

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792467160-7192cedf-ad20-4fd0-bcb2-4f7557fc904d.png)

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792523507-460b449b-cd80-4efc-897b-898aa544d09a.png)![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792559182-d559fb1a-94e4-49ad-a13a-f9848fa7f784.png)![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792603109-0c127f51-0fd2-4f86-9290-1f25cf7b4deb.png)![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792626661-af14bf9c-6dfb-4306-beaf-d4153095ffbf.png)![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1620792659190-7a5767d3-64f9-4f57-a247-1bbe65f45da5.png)

## JSä¿®æ”¹
### ä¸»é¢˜4.0.0ä»¥ä¸‹ç‰ˆæœ¬
<font style="color:#23263B;">åˆ°è¿™é‡Œè¿˜æ²¡æœ‰ç»“æŸï¼Œå¦‚æœä½ è¿™æ ·æ“ä½œå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾ä½ çš„è®¿é—®æµé‡å¾ˆå¤§ï¼Œæœ‰å¾ˆå¤šäººç”¨æœç´¢åŠŸèƒ½ï¼Œé‚£ä¹ˆå…è´¹çš„1ä¸‡æ¬¡æœç´¢é¢åº¦å¯èƒ½ä¸å¤Ÿä¸€ä¸ªæœˆçš„ä½¿ç”¨ï¼Œéœ€è¦æŒ‰ä¸‹</font>`<font style="color:#23263B;">ENTER</font>`<font style="color:#23263B;">é”®å†æ‰§è¡Œæœç´¢è€Œä¸æ˜¯å®æ—¶æœç´¢ï¼Œå› æ­¤å¯ä»¥ç¨ä½œä¿®æ”¹ï¼ˆ</font>blog\themes\butterfly\source\js\search\algolia.js) jsçš„éƒ¨åˆ†å†…å®¹<font style="color:#23263B;">ï¼Œä¸æƒ³åŠ¨æºç çš„å¯ä»¥ä¿å­˜åˆ°å…¶ä»–ä¸ä¸»é¢˜ä¸å†²çªçš„è·¯å¾„ï¼Œç„¶åæ›´æ¢ CDN åœ°å€å³å¯</font>

<font style="color:#23263B;">ä¸»è¦ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼Œç„¶åå°±æ˜¯æ’ç‰ˆé—®é¢˜æ”¹äº†æ”¹ä½ç½®ï¼Œä¸å–œæ¬¢çš„å¯ä»¥ä¸æ”¹ï¼Œå¾ˆç›´ç™½å°±ä¸ç”¨è¿‡å¤šè§£é‡Šäº†ï¼Œè¿™æ ·å°±å¯è·å¾—å’Œæœ¬åšå®¢ä¸€æ ·çš„æœç´¢æ•ˆæœäº†</font>

```diff
  search.addWidget(
    instantsearch.widgets.searchBox({
      container: '#algolia-search-input',
      reset: false,
      magnifier: false,
+      searchOnEnterKeyPressOnly: true,
      placeholder: GLOBAL_CONFIG.algolia.languages.input_placeholder
    })
  )
  search.addWidget(
    instantsearch.widgets.hits({
      container: '#algolia-hits',
      templates: {
        item: function (data) {
          const link = data.permalink ? data.permalink : (GLOBAL_CONFIG.root + data.path)
          return (
            '<a href="' + link + '" class="algolia-hit-item-link"><b>' +
            data._highlightResult.title.value + '</b><br>'
+            + data._snippetResult.contentStrip.value + '<br>( åŒ¹é…å­—è¯ : ' 
+            + data._highlightResult.contentStrip.matchedWords + ' ) | ( åŒ¹é…ç­‰çº§ : ' 
+            + data._highlightResult.contentStrip.matchLevel + ' )</a>'
          )
        },
```

### ä¸»é¢˜4.0.0ä»¥ä¸Šç‰ˆæœ¬
å·²ç»å‡çº§åˆ°V4ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä¸€äº›ç‰¹æ€§å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä¿®æ”¹å†…å®¹å…¶å®å·®ä¸å¤šï¼Œåªæ˜¯å»ºè®®å¯¹äºç¬¬87è¡Œçš„é¡µæ•°é™åˆ¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‰‹æœºä¸Šæ’ç‰ˆç¾è§‚ï¼Œä¸ä¼šè½¬åˆ°ä¸‹ä¸€è¡Œï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœç»“æœè¶…è¿‡5é¡µï¼Œé‚£ä¹ˆå°†æ— æ³•æ˜¾ç¤ºï¼Œæœ€åä¸€é¡µä»£è¡¨ç¬¬5é¡µï¼Œæ‰€ä»¥æˆ‘ä¸ªäººä¼šé€‰æ‹©åˆ æ‰è¿™ä¸ªå‚æ•°é™åˆ¶ï¼ŒåŒæ—¶åˆå¹¶åˆ é™¤äº†éƒ¨åˆ†ä»£ç ï¼Œä»¥åŠä½¿ç”¨widgetçš„powerbyç»„ä»¶è€Œä¸æ˜¯å®˜æ–¹çš„svgä»£ç è§£å†³æ–¹æ¡ˆã€‚å¦å¤–å› ä¸ºæ–°ç‰ˆå®˜æ–¹çš„æ¯æ¬¡è®¿é—®ç½‘ç«™éƒ½ä¼šæœ‰ä¸€æ¬¡å…¨å±€è¯·æ±‚ï¼Œè¿™åœ¨æ¶ˆè€—å…è´¹é¢åº¦çš„åŒæ—¶ï¼Œä¹Ÿå½±å“ç½‘ç«™åŠ è½½çš„é€Ÿåº¦ï¼Œæ‰€ä»¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºä¸ºæŒ‰ä¸‹å›è½¦åå†è¯·æ±‚

åŒæ ·çš„éƒ¨åˆ†å‚æ•°å‘ç”Ÿäº†æ”¹å˜ï¼ˆL55-59ï¼‰ï¼Œå¯ä»¥è‡ªè¡Œæ¯”å¯¹æˆ–æŸ¥çœ‹[**å®˜æ–¹æ–‡æ¡£**](https://www.algolia.com/doc/guides/building-search-ui/getting-started/js/)ï¼Œä¹Ÿå¯ä»¥ç›´æ¥[**å¼•ç”¨æˆ‘çš„**](https://cdn.jsdelivr.net/gh/CCKNBC/ccknbc.github.io/js/search/algolia.js)

****

**ç‰¹åˆ«æä¸€å˜´**

**å®˜æ–¹åˆ‡ç‰‡æ–¹å¼å¯¹æˆ‘æ¥è¯´140ä¸ªå­—å¤ªé•¿äº†ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥æ¥å—å°±ç”¨å®˜æ–¹çš„ï¼Œä¸ç”¨åšå…¶ä»–æ›´æ”¹ï¼Œä½†æƒ³è¦å’Œæˆ‘çš„æ˜¾ç¤ºæ–¹å¼ä¸€æ ·ï¼Œå°±æ³¨æ„é…ç½®å¥½åˆ‡ç‰‡ï¼Œé»˜è®¤æ˜¯10ä¸ªè¯ç¬¦ï¼Œæ¯•ç«Ÿæœ‰ç°æˆçš„åˆ‡ç‰‡é«˜äº®å¤„ç†å¯ä»¥ç”¨ï¼Œå°±æ²¡å¿…è¦å†æ¥ä¸€æ¬¡äº†**

****

![](https://cdn.nlark.com/yuque/0/2022/png/8391407/1669548282470-47f14d26-cf31-4b01-8890-5946f68c699e.png)

å¦å¤–ï¼Œæ–°ç‰ˆæµè§ˆå™¨æ”¯æŒæœç´¢å¹¶å®šä½é«˜äº®å¤„ç†ï¼Œæ‰€ä»¥å¯¹è·³è½¬é“¾æ¥ä¹Ÿåšäº†å¤„ç†ï¼Œç®—æ˜¯å¼¥è¡¥äº†ä¸€ç‚¹ä¸èƒ½ç²¾å‡†å®šä½çš„ç¼ºé™·ï¼Œæ¯”å¦‚ç‚¹å‡»å¦‚ä¸‹é“¾æ¥å®ƒä¼šè·³è½¬åˆ°æœç´¢ç»“æœå¯¹åº”çš„ä½ç½®ï¼Œè‡³äºå‰ååŒ¹é…å¤šå°‘å­—ç¬¦ä½ ä»¬è‡ªè¡Œä¿®æ”¹ï¼Œä½†ä¹Ÿæ˜¯å¤„äºä¸å¤ªå¥½ç”¨çš„çŠ¶æ€ï¼Œæ¯•ç«Ÿæ˜¯åˆ†ç‰‡è¿˜æ˜¯æœ‰ç‚¹å¥‡æ€ªï¼Œå¯¹è‹±æ–‡æ¥è¯´åº”è¯¥æ˜¯å•è¯è¯†åˆ«ï¼Œåªæ˜¯ä¸­æ–‡æ°å·§æ˜¯å¦ä¸€æ ‡å‡†ï¼Œå•å­—å˜æˆäº†è¯



[#:~:text=å‹¿æ»¥ç”¨-,è¡¨æƒ…,-ç¬¦å·å’Œ](/posts/how-to-ask-questions-the-smart-way/#:~:text=å‹¿æ»¥ç”¨-,è¡¨æƒ…,-ç¬¦å·å’Œ)



![](https://cdn.nlark.com/yuque/0/2022/png/8391407/1669550104799-99697278-0900-4dca-aa04-65a5a2536c1d.png)



```yaml
CDN:
  # search
  algolia_js: https://cdn.jsdelivr.net/gh/CCKNBC/ccknbc.github.io/js/search/algolia.js
```

```javascript
window.addEventListener('load', () => {
  const openSearch = () => {
    const bodyStyle = document.body.style
    bodyStyle.width = '100%'
    bodyStyle.overflow = 'hidden'
    btf.animateIn(document.getElementById('search-mask'), 'to_show 0.5s')
    btf.animateIn(document.querySelector('#algolia-search .search-dialog'), 'titleScale 0.5s')
    setTimeout(() => { document.querySelector('#algolia-search .ais-SearchBox-input').focus() }, 100)

    // shortcut: ESC
    document.addEventListener('keydown', function f (event) {
      if (event.code === 'Escape') {
        closeSearch()
        document.removeEventListener('keydown', f)
      }
    })
  }

  const closeSearch = () => {
    const bodyStyle = document.body.style
    bodyStyle.width = ''
    bodyStyle.overflow = ''
    btf.animateOut(document.querySelector('#algolia-search .search-dialog'), 'search_close .5s')
    btf.animateOut(document.getElementById('search-mask'), 'to_hide 0.5s')
  }

  const searchClickFn = () => {
    document.querySelector('#search-button > .search').addEventListener('click', openSearch)
  }

  const searchClickFnOnce = () => {
    document.getElementById('search-mask').addEventListener('click', closeSearch)
    document.querySelector('#algolia-search .search-close-button').addEventListener('click', closeSearch)
  }

  const algolia = GLOBAL_CONFIG.algolia
  const isAlgoliaValid = algolia.appId && algolia.apiKey && algolia.indexName
  if (!isAlgoliaValid) {
    return console.error('Algolia setting is invalid!')
  }

  const search = instantsearch({
    indexName: algolia.indexName,
    searchClient: algoliasearch(algolia.appId, algolia.apiKey),
    searchFunction(helper) {
      helper.state.query && helper.search()
    },
  })

  const configure = instantsearch.widgets.configure({
    hitsPerPage: algolia.per_page || 5
  })

  const searchBox = instantsearch.widgets.searchBox({
    container: '#algolia-search-input',
    showReset: false,
    showSubmit: false,
    searchAsYouType: false,
    placeholder: GLOBAL_CONFIG.algolia.languages.input_placeholder,
    showLoadingIndicator: true
  })

  const hits = instantsearch.widgets.hits({
    container: '#algolia-hits',
    templates: {
      item(data) {
        const link = data.permalink ? data.permalink : (GLOBAL_CONFIG.root + data.path)
        const content = data._snippetResult.contentStrip.value
        return `
          <a href="${link}#:~:text=${content.substring(content.indexOf('<mark>')-3,content.indexOf('<mark>'))}-,${content.substring(content.indexOf('<mark>')+6,content.indexOf('</mark>'))},-${content.substring(content.indexOf('</mark>')+7,content.indexOf('</mark>')+10)}" class="algolia-hit-item-link">
          <b>${data._highlightResult.title.value || "no-title"}</b>
          <br>${content}</br>
          åŒ¹é…å­—è¯: <em><mark>${
          data._highlightResult.contentStrip.matchedWords
          }</mark></em> | åŒ¹é…ç­‰çº§: <em><mark>${
          data._highlightResult.contentStrip.matchLevel
          }</mark></em>
          </a>`;
      },
      empty: function (data) {
        return (
          '<div id="algolia-hits-empty">' +
          GLOBAL_CONFIG.algolia.languages.hits_empty.replace(/\$\{query}/, data.query) +
          '</div>'
        )
      }
    }
  })

  const stats = instantsearch.widgets.stats({
    container: '#algolia-info > .algolia-stats',
    templates: {
      text: function (data) {
        const stats = GLOBAL_CONFIG.algolia.languages.hits_stats
          .replace(/\$\{hits}/, data.nbHits)
          .replace(/\$\{time}/, data.processingTimeMS)
        return (
          `<hr>${stats}`
        )
      }
    }
  })

  const powerBy = instantsearch.widgets.poweredBy({
    container: '#algolia-info > .algolia-poweredBy',
  })

  const pagination = instantsearch.widgets.pagination({
    container: '#algolia-pagination',
    totalPages: algolia.totalPages,
    templates: {
      first: '<i class="fa-solid fa-angle-double-left" title="ç¬¬ä¸€é¡µ"></i>',
      last: '<i class="fa-solid fa-angle-double-right" title="æœ€åä¸€é¡µ"></i>',
      previous: '<i class="fa-solid fa-angle-left" title="ä¸Šä¸€é¡µ"></i>',
      next: '<i class="fa-solid fa-angle-right" title="ä¸‹ä¸€é¡µ"></i>'
    }
  })


  search.addWidgets([configure,searchBox,hits,stats,powerBy,pagination]) // add the widgets to the instantsearch instance

  search.start()

  searchClickFn()
  searchClickFnOnce()

  window.addEventListener('pjax:complete', () => {
    getComputedStyle(document.querySelector('#algolia-search .search-dialog')).display === 'block' && closeSearch()
    searchClickFn()
  })

  window.pjax && search.on('render', () => {
    window.pjax.refresh(document.getElementById('algolia-hits'))
  })
})
```

## æ•ˆæœé¢„è§ˆ
![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1623297948979-16f7476e-0978-49ee-a667-2dc060896c88.png)

ï¼ˆè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä¿®æ”¹äº†æºç ï¼Œå®é™…ä¸Šä¹Ÿèƒ½é€šè¿‡ä¿®æ”¹ JS å®ç°ï¼Œä½†å¤§å¤šæ•°äººä¸ä¼šå…³å¿ƒè¿™äº›æœç´¢å°è´´å£«ï¼‰

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1623298049726-3cded22e-2e40-44b3-a445-d542b3bc3c80.png)

å¯¹äºä¸­æ–‡å®ƒå½“ä½œå•å­—åŒ¹é…

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1623298062241-b4dd37f7-aa87-485f-a394-950943e0c211.png)

å…è®¸æ‹¼å†™é”™è¯¯

![](https://cdn.nlark.com/yuque/0/2021/png/8391407/1623298137784-eb2713f9-377f-4f5d-824d-a7a7b7a881c4.png)

## ç‰¹åˆ«è¯´æ˜
å› ä¸¤ä¸ªæœˆå‰å·²ç”³è¯·é€šè¿‡ï¼Œæœ¬åšå®¢å·²åˆ‡æ¢è‡³ä¸é™æœç´¢æ¬¡æ•°çš„[**DocSearch**](https://docsearch.algolia.com/)ï¼åŒæ—¶ä¹ŸåŠ å…¥äº†[**å¼€æºè®¡åˆ’**](https://www.algolia.com/for-open-source/)ï¼Œä½†å› ä¸º10DSNå¤ªé¦™äº†ï¼Œè™½ç„¶instantsearchå¯ç©æ€§æ›´å¥½ï¼Œä½†æˆ‘ä¹Ÿåªç”³è¯·äº†200k/æœˆçš„é¢åº¦ï¼ˆè™½ç„¶å¯ä»¥å¢åŠ ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†å³æ—¶æœç´¢æˆ‘è¿˜æ˜¯é€‰æ‹©äº†ç™½å«–ï¼Œè€Œä¸”è®¾å®šä¸ºæ¯å¤©è‡ªåŠ¨çˆ¬å–çš„è¯ï¼Œçœå»äº†ç”Ÿæˆç´¢å¼•ä¸Šä¼ çš„è¿™ä¸€æ­¥éª¤ï¼ŒèŠ‚çœäº†è‡ªåŠ¨éƒ¨ç½²çš„æ—¶é—´ã€‚è€Œä¸”çˆ¬å–åˆ°æ•°æ®åï¼Œå‰ç«¯æˆ‘å¹¶éä¸€å®šè¦ä½¿ç”¨docsearchæ–¹æ¡ˆï¼Œç”¨instantsearché…åˆå…¶ä»–æ’ä»¶ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/8391407/1676545133728-0a8f5c54-05e9-422c-b427-21087c6b0372.png)





